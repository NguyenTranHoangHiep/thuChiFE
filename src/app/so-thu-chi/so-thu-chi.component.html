<div class="container mt-4">
  <h3 class="text-center mb-4">Danh s√°ch giao d·ªãch</h3>

  <!-- N√∫t th√™m giao d·ªãch -->
  <div class="d-flex flex-column align-items-start">

  <!-- Nh√≥m n√∫t Th√™m + Xu·∫•t Excel -->
  <div class="d-flex mb-3">
    <button class="btn btn-success me-2 px-3" (click)="openAddModal()">Th√™m</button>
    <button class="btn btn-primary" (click)="xuatExcel()" style="background-color: #330066; border: none; color: white;">
    Xu·∫•t Excel
    </button>

  </div>

  <!-- Nh√≥m Input + Select ngang h√†ng -->
  <div class="d-flex align-items-center mb-3" style="width: 100%;">
    <input
      type="text"
      placeholder="T√¨m ki·∫øm theo t·ª´ kh√≥a"
      [(ngModel)]="tuKhoaLoc"
      (input)="onFilterChange()"
      class="form-control me-2"
      style="width: 25%;"
    />
    <!-- l·ªçc theo thu chi -->
    <select
      class="form-select"
      [(ngModel)]="loaiLoc"
      (change)="applyFilterAndPagination()"
      style="width: 15%;"
    >
      <option value="">T·∫•t c·∫£</option>
      <option value="thu">Thu</option>
      <option value="chi">Chi</option>
    </select>
    <!-- l·ªçc theo ng√†y giao d·ªãch -->
    <div class="d-flex gap-2 align-items-center" style="margin-left:1%;">
  <input
    type="date"
    [(ngModel)]="fromDate"
    (change)="applyFilterAndPagination()"
    class="form-control"
    style="width: 170px;"
    placeholder="T·ª´ ng√†y"
  />

  <input
    type="date"
    [(ngModel)]="toDate"
    (change)="applyFilterAndPagination()"
    class="form-control"
    style="width: 170px;"
    placeholder="ƒê·∫øn ng√†y"
  />
</div>
  </div>
</div>

  <!-- Modal th√™m giao d·ªãch -->
  <div *ngIf="showAddModal" class="modal-overlay">
    <div class="modal-content">
      <h5>Th√™m giao d·ªãch m·ªõi</h5>
      <form (ngSubmit)="themGiaoDich()" #formGiaoDich="ngForm">

        <div class="mb-2">
          <label>T√™n danh m·ª•c:</label>
          <select class="form-select" [(ngModel)]="giaoDichMoi.tenDanhMuc" name="tenDanhMuc" required>
            <option value="" disabled selected>-- Ch·ªçn danh m·ª•c --</option>
            <option *ngFor="let dm of danhSachDanhMuc" [value]="dm.tenDanhMuc">
              {{ dm.loai === 'thu' ? 'üí∞ ' : 'üõí ' }}{{ dm.tenDanhMuc }}
            </option>
          </select>
        </div>

        <div class="mb-2">
          <label>S·ªë ti·ªÅn:</label>
          <input type="number" class="form-control" [(ngModel)]="giaoDichMoi.soTien" name="soTien" required />
        </div>

        <div class="mb-2">
          <label>Ghi ch√∫:</label>
          <input type="text" class="form-control" [(ngModel)]="giaoDichMoi.ghiChu" name="ghiChu" />
        </div>

        <div class="mb-2">
          <label>Ng√†y giao d·ªãch:</label>
          <input type="date" class="form-control" [(ngModel)]="giaoDichMoi.ngayGiaoDich" name="ngayGiaoDich" required />
        </div>

        <button type="submit" class="btn btn-primary" [disabled]="formGiaoDich.invalid">L∆∞u</button>
        <button type="button" class="btn btn-secondary ms-2" (click)="closeAddModal()">H·ªßy</button>
      </form>
    </div>
  </div>

<!-- B·∫£ng hi·ªÉn th·ªã giao d·ªãch -->
<div class="table-responsive">
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>T√™n Danh M·ª•c</th>
        <th>S·ªë Ti·ªÅn</th>
        <th>Lo·∫°i</th>
        <th>Ng√†y Giao D·ªãch</th>
        <th>Ng√†y T·∫°o</th>
        <th>Ghi Ch√∫</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <!-- D√πng danh s√°ch ƒë√£ ph√¢n trang -->
      <tr *ngFor="let gd of giaoDichTheoTrang">
        <td>{{ gd.tenDanhMuc }}</td>
        <td>{{ gd.soTien | number:'1.0-0' }}</td>
        <td>{{ gd.loai === 'thu' ? 'Thu' : 'Chi' }}</td>
        <td>{{ gd.ngayGiaoDich | date:'dd/MM/yyyy' }}</td>
        <td>{{ gd.ngayTao | date:'dd/MM/yyyy HH:mm' }}</td>
        <td>{{ gd.ghiChu }}</td>
        <td>
          <button class="btn btn-sm btn-danger me-2" (click)="xoaGiaoDich(gd.maGiaoDich)">X√≥a</button>
          <button class="btn btn-sm btn-warning me-2" (click)="moEditModal(gd)">S·ª≠a</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Ph√¢n trang -->
<nav *ngIf="totalPages > 1">
  <ul class="pagination justify-content-center mt-3">
    <li class="page-item" [class.disabled]="page === 1">
      <button class="page-link" (click)="changePage(page - 1)" [disabled]="page === 1">&lt;</button>
    </li>
    <li
      class="page-item"
      *ngFor="let p of [].constructor(totalPages); let i = index"
      [class.active]="page === i + 1"
    >
      <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
    </li>
    <li class="page-item" [class.disabled]="page === totalPages">
      <button class="page-link" (click)="changePage(page + 1)" [disabled]="page === totalPages">&gt;</button>
    </li>
  </ul>
</nav>

</div>
<!-- Modal s·ª≠a giao d·ªãch -->
<div *ngIf="showEditModal" class="modal-overlay">
  <div class="modal-content">
    <h5>C·∫≠p nh·∫≠t giao d·ªãch</h5>
    <form (ngSubmit)="capNhatGiaoDich()" #formEditGiaoDich="ngForm">

      <div class="mb-2">
        <label>T√™n danh m·ª•c:</label>
        <select class="form-select" [(ngModel)]="giaoDichDangSua.tenDanhMuc" name="editTenDanhMuc" required>
          <option value="" disabled selected>-- Ch·ªçn danh m·ª•c --</option>
          <option *ngFor="let dm of danhSachDanhMuc" [value]="dm.tenDanhMuc">
            {{ dm.loai === 'thu' ? 'üí∞ ' : 'üõí ' }}{{ dm.tenDanhMuc }}
          </option>
        </select>
      </div>

      <div class="mb-2">
        <label>S·ªë ti·ªÅn:</label>
        <input type="number" class="form-control" [(ngModel)]="giaoDichDangSua.soTien" name="editSoTien" required />
      </div>

      <div class="mb-2">
        <label>Ghi ch√∫:</label>
        <input type="text" class="form-control" [(ngModel)]="giaoDichDangSua.ghiChu" name="editGhiChu" />
      </div>

      <div class="mb-2">
        <label>Ng√†y giao d·ªãch:</label>
        <input type="date" class="form-control" [(ngModel)]="giaoDichDangSua.ngayGiaoDich" name="editNgayGiaoDich" required />
      </div>

      <button type="submit" class="btn btn-primary" [disabled]="formEditGiaoDich.invalid">L∆∞u</button>
      <button type="button" class="btn btn-secondary ms-2" (click)="closeEditModal()">H·ªßy</button>
    </form>
  </div>
</div>
